<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0",user-scalable=no>
    <title>medicine</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <nav>
        <h1 class="brand"><a href="#">GDPU.Xu.lab</a></h1>
        <ul>
            <li><a href="https://link.springer.com/article/10.1186/s12859-020-3430-0">Home</a></li>
            <li><a href="#">About</a></li>
            <li><a href="#">Services</a></li>
            <li><a href="#">Comtact</a></li>
        </ul>
        <div style="clear: both;"></div>
    </nav>

    <!-- ä¸Šéƒ¨åˆ†ï¼šè§†è§‰æ»šåŠ¨å·®åŒºåŸŸ -->
    <div class="parallax-container">
        <img src="./bj.png" id="mood" alt="æœ¨æ¡ŒèƒŒæ™¯">
        <img src="./01.png" class="herb-img" id="herb1" alt="è¯æ1">
        <img src="./02.png" class="herb-img" id="herb2" alt="è¯æ2">
        <h2 id="text">medicine</h2>
    </div>

    <!-- ä¸‹éƒ¨åˆ†ï¼šè¯æä»‹ç»å†…å®¹åŒºåŸŸ -->
    <div class="content-container">
        <div class="content">
            <h1>è¯æä»‹ç»</h1>
            <p>è¿™é‡Œæ˜¯ç¬¬ä¸€éƒ¨åˆ†çš„è¯¦ç»†ä»‹ç»ã€‚...</p>
            <p>è¿™é‡Œæ˜¯ç¬¬äºŒéƒ¨åˆ†çš„è¯¦ç»†ä»‹ç»ã€‚...</p>
            <p>è¿™é‡Œæ˜¯ç¬¬ä¸‰éƒ¨åˆ†çš„è¯¦ç»†ä»‹ç»ã€‚...</p>
            <p>è¿™é‡Œæ˜¯ç¬¬å››éƒ¨åˆ†çš„è¯¦ç»†ä»‹ç»ã€‚...</p>
            <p>è¿™é‡Œæ˜¯ç¬¬äº”éƒ¨åˆ†çš„è¯¦ç»†ä»‹ç»ã€‚...</p>
            <p>è¿™é‡Œæ˜¯ç¬¬å…­éƒ¨åˆ†çš„è¯¦ç»†ä»‹ç»ã€‚...</p>
            <p>è¿™é‡Œæ˜¯ç¬¬ä¸ƒéƒ¨åˆ†çš„è¯¦ç»†ä»‹ç»ã€‚...</p>
            <p>è¿™é‡Œæ˜¯ç¬¬å…«éƒ¨åˆ†çš„è¯¦ç»†ä»‹ç»ã€‚...</p>
            
            <br>
            <hr>

            <h1>ä½¿ç”¨</h1>
            <p>è¿™é‡Œæ˜¯ä½¿ç”¨è¯´æ˜...</p>
        <div class="model-container">

        <!-- 1. æ–‡ä»¶ä¸Šä¼ åŒºåŸŸ -->
        <div class="upload-area">
            <label for="file-upload">ä¸Šä¼ æ–‡ä»¶ï¼ˆé€‚é…æ¨¡å‹è¾“å…¥ï¼‰ï¼š</label>
            <input type="file" id="file-upload" class="file-input" accept="*"> <!-- å¯ä¿®æ”¹accepté™åˆ¶æ–‡ä»¶ç±»å‹ -->
            <button class="submit-btn" id="submit-btn" disabled>æ¨¡å‹å¤„ç†</button>
        </div>
        
        
        <!-- 2. å¤„ç†çŠ¶æ€æç¤ºï¼ˆåŠ è½½ä¸­/æˆåŠŸ/å¤±è´¥ï¼‰ -->
        <div class="status-tip" id="status-tip">è¯·ä¸Šä¼ æ–‡ä»¶å¹¶æäº¤</div>
        <hr>
        <br>
        <br>
        <!-- 3. æ¨¡å‹ç”Ÿæˆç»“æœåŒºåŸŸï¼ˆå›¾ç‰‡+è¯´æ˜ï¼‰ -->
        <div class="result-area">
            <!-- ç”Ÿæˆå›¾ç‰‡çš„è¾“å‡ºæ¡† -->
            <div class="generated-image-box" id="image-result-box">
                <span class="no-result-tip">æ¨¡å‹å°†åœ¨æ­¤ç”Ÿæˆå›¾ç‰‡</span>
            </div>

            <!-- ç”Ÿæˆè¯´æ˜çš„æ–‡æœ¬æ¡† -->
            <div class="generated-desc-box" id="desc-result-box">
                <span class="no-result-tip">æ¨¡å‹å°†åœ¨æ­¤ç”Ÿæˆå¤„ç†è¯´æ˜</span>
            </div>
        </div>
        </div>
        </div>
 
    </div>

    


   
<script>
        <!----è§†è§‰æ»šåŠ¨å·®---->
        window.addEventListener('scroll', function() {
            const scrollY = window.pageYOffset;
            const containerHeight = document.querySelector('.parallax-container').offsetHeight;
            // è®¡ç®—å»¶è¿Ÿè§¦å‘çš„é˜ˆå€¼ï¼šå®¹å™¨é«˜åº¦çš„30%
            const delayThreshold = containerHeight * 0.2;

            if (scrollY < containerHeight) {
                // 1. ç¬¬ä¸€å¼ å›¾ï¼ˆherb1ï¼‰ï¼šæ— å»¶è¿Ÿï¼Œæ­£å¸¸æ»šåŠ¨
                const herb1 = document.getElementById('herb1');
                herb1.style.transform = `translate(-50%, calc(-50% + ${scrollY * 0.2}px))`;
                
                // 2. ç¬¬äºŒå¼ å›¾ï¼ˆherb2ï¼‰ï¼šå»¶è¿Ÿè§¦å‘ï¼Œæ»šåŠ¨è·ç¦»è¶…è¿‡30%æ‰å¼€å§‹åŠ¨
                const herb2 = document.getElementById('herb2');
                if (scrollY > delayThreshold) {
                    // è®¡ç®—â€œè¶…å‡ºå»¶è¿Ÿé˜ˆå€¼çš„æ»šåŠ¨è·ç¦»â€ï¼Œå†ä¹˜ä»¥ç§»åŠ¨ç³»æ•°
                    const delayedScroll = scrollY - delayThreshold;
                    herb2.style.transform = `translate(calc(-50%), calc(-50% + ${delayedScroll * 0.5}px))`;
                } else {
                    // æœªè¾¾åˆ°å»¶è¿Ÿé˜ˆå€¼æ—¶ï¼Œä¿æŒåˆå§‹ä½ç½®
                    herb2.style.transform = 'translate(-50%, -50%)';    
                }
            }
        });


         // 1. è·å–æ‰€æœ‰DOMå…ƒç´ 
        const fileInput = document.getElementById('file-upload');
        const submitBtn = document.getElementById('submit-btn');
        const statusTip = document.getElementById('status-tip');
        const imageResultBox = document.getElementById('image-result-box');
        const descResultBox = document.getElementById('desc-result-box');

        // 2. ç›‘å¬æ–‡ä»¶ä¸Šä¼ ï¼Œå…è®¸æäº¤æŒ‰é’®
        fileInput.addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file) {
                submitBtn.disabled = false;
                statusTip.textContent = `å·²é€‰æ‹©æ–‡ä»¶ï¼š${file.name}`;
            } else {
                submitBtn.disabled = true;
                statusTip.textContent = 'è¯·ä¸Šä¼ æ–‡ä»¶å¹¶æäº¤';
            }
        });

        // 3. æäº¤æ–‡ä»¶ç»™æ·±åº¦å­¦ä¹ æ¨¡å‹ï¼ˆæ ¸å¿ƒé€»è¾‘ï¼‰
        submitBtn.addEventListener('click', async () => {
            const file = fileInput.files[0];
            if (!file) return;

            // åˆå§‹åŒ–çŠ¶æ€ï¼šåŠ è½½ä¸­
            submitBtn.disabled = true;
            statusTip.textContent = 'æ­£åœ¨è°ƒç”¨æ¨¡å‹å¤„ç†...ï¼ˆè¯·ç¨ç­‰ï¼‰';
            clearResult(); // æ¸…ç©ºä¸Šä¸€æ¬¡ç»“æœ

            try {
                // ğŸ”´ æ ¸å¿ƒï¼šæ„å»ºFormDataï¼ˆé€‚é…å¤§å¤šæ•°æ¨¡å‹æ¥å£ï¼Œä¸Šä¼ æ–‡ä»¶ï¼‰
                const formData = new FormData();
                formData.append('file', file); // 'file'æ˜¯æ¥å£å‚æ•°åï¼Œéœ€å’Œä½ çš„æ¨¡å‹æ¥å£ä¸€è‡´

                // ğŸŸ¡ å…³é”®ï¼šè°ƒç”¨ä½ çš„æ·±åº¦å­¦ä¹ æ¨¡å‹æ¥å£ï¼ˆæ›¿æ¢æˆä½ çš„æ¨¡å‹åœ°å€ï¼‰
                const response = await fetch('http://ä½ çš„æ¨¡å‹æ¥å£åœ°å€:ç«¯å£/process', {
                    method: 'POST',
                    body: formData,
                    // è‹¥æ¨¡å‹æ¥å£éœ€è¦æƒé™ï¼ˆå¦‚tokenï¼‰ï¼Œæ·»åŠ headersï¼Œç¤ºä¾‹ï¼š
                    // headers: { 'Authorization': 'Bearer ä½ çš„token' }
                });

                // éªŒè¯æ¥å£å“åº”
                if (!response.ok) throw new Error('æ¨¡å‹å¤„ç†å¤±è´¥');
                const result = await response.json(); // å‡è®¾æ¨¡å‹è¿”å›JSONæ ¼å¼ï¼ˆå«å›¾ç‰‡+è¯´æ˜ï¼‰

                // ğŸŸ¢ æ¥æ”¶æ¨¡å‹è¿”å›çš„ç»“æœï¼ˆéœ€å’Œä½ çš„æ¨¡å‹è¾“å‡ºæ ¼å¼å¯¹åº”ï¼‰
                const generatedImageUrl = result.image_url; // æ¨¡å‹ç”Ÿæˆçš„å›¾ç‰‡åœ°å€
                const generatedDesc = result.description; // æ¨¡å‹ç”Ÿæˆçš„è¯´æ˜æ–‡æœ¬

                // å±•ç¤ºç»“æœåˆ°é¡µé¢
                showResult(generatedImageUrl, generatedDesc);
                statusTip.textContent = 'æ¨¡å‹å¤„ç†å®Œæˆâœ…';

            } catch (error) {
                // é”™è¯¯å¤„ç†ï¼ˆæ¨¡å‹è°ƒç”¨å¤±è´¥/ç½‘ç»œé”™è¯¯ï¼‰
                statusTip.textContent = `å¤„ç†å¤±è´¥ï¼š${error.message}`;
                imageResultBox.innerHTML = '<span class="no-result-tip">å›¾ç‰‡ç”Ÿæˆå¤±è´¥</span>';
                descResultBox.innerHTML = '<span class="no-result-tip">è¯´æ˜ç”Ÿæˆå¤±è´¥</span>';
            } finally {
                submitBtn.disabled = false; // æ¢å¤æäº¤æŒ‰é’®
            }
        });

        // è¾…åŠ©å‡½æ•°ï¼šæ¸…ç©ºç»“æœ
        function clearResult() {
            imageResultBox.innerHTML = '<span class="no-result-tip">æ¨¡å‹å°†åœ¨æ­¤ç”Ÿæˆå›¾ç‰‡</span>';
            descResultBox.innerHTML = '<span class="no-result-tip">æ¨¡å‹å°†åœ¨æ­¤ç”Ÿæˆå¤„ç†è¯´æ˜</span>';
        }

        // è¾…åŠ©å‡½æ•°ï¼šå±•ç¤ºç»“æœï¼ˆå›¾ç‰‡+è¯´æ˜ï¼‰
        function showResult(imgUrl, desc) {
            // å±•ç¤ºç”Ÿæˆçš„å›¾ç‰‡
            const img = document.createElement('img');
            img.src = imgUrl;
            img.className = 'generated-image';
            imageResultBox.innerHTML = '';
            imageResultBox.appendChild(img);

            // å±•ç¤ºç”Ÿæˆçš„è¯´æ˜
            descResultBox.textContent = desc || 'æ¨¡å‹æœªè¿”å›è¯´æ˜';
        }
</script>
</body>
</html>